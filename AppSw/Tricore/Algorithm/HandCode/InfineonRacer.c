/******************************************************************************/
/*----------------------------------Includes----------------------------------*/
/******************************************************************************/
#include "InfineonRacer.h"
#include "Basic.h"

/******************************************************************************/
/*-----------------------------------Macros-----------------------------------*/
/******************************************************************************/

/******************************************************************************/
/*--------------------------------Enumerations--------------------------------*/
/******************************************************************************/

/******************************************************************************/
/*-----------------------------Data Structures--------------------------------*/
/******************************************************************************/

/******************************************************************************/
/*------------------------------Global variables------------------------------*/
/******************************************************************************/

InfineonRacer_t IR_Ctrl  /**< \brief  global data */
		={64, 64, 64};
/******************************************************************************/
/*-------------------------Function Prototypes--------------------------------*/
/******************************************************************************/

/******************************************************************************/
/*------------------------Private Variables/Constants-------------------------*/
/******************************************************************************/

/******************************************************************************/
/*-------------------------Function Implementations---------------------------*/
/******************************************************************************/
void InfineonRacer_init(void){
	;
}

void InfineonRacer_detectLane(void){
	/* IR_LineScan.adcResult 의 정보를 읽어들여서
	 * IR_Ctrl.Ls0Margin, IR_Ctrl.Ls1Margin 정보를 계산한다
	 */
}

void InfineonRacer_detectCrossWalk(void){
	/* IR_LineScan.adcResult 의 정보를 읽어들여서
	 * 횡단보도를 검출한다.
	 */
	/*for(int i=0; i<126 ; i++)
	{
		IR_Ctrl.LPF1_3[i] = (float32)IR_LineScan.adcResult[0][i]*0.25
							+ (float32)IR_LineScan.adcResult[0][i+1]*0.5
							+ (float32)IR_LineScan.adcResult[0][i+2]*0.25;

	}*/
	IR_Ctrl.Count=0;
	IR_Ctrl.MAX =0;

	for(int i=0; i<124 ; i++)
	{
		IR_Ctrl.LPF1_5[i] = (float32)IR_LineScan.adcResult[0][i]*0.1
							+ (float32)IR_LineScan.adcResult[0][i+1]*0.2
							+ (float32)IR_LineScan.adcResult[0][i+2]*0.4
							+ (float32)IR_LineScan.adcResult[0][i+3]*0.2
							+ (float32)IR_LineScan.adcResult[0][i+4]*0.1;

	}

	for(int i=0; i<124 ; i++)
	{
		if(IR_Ctrl.LPF1_5[i]>IR_Ctrl.MAX)
		{
			IR_Ctrl.MAX = IR_Ctrl.LPF1_5[i];
		}
	}
	for(int i =0 ; i<124 ; i++)
	{
		if(IR_Ctrl.LPF1_5[i]>IR_Ctrl.MAX*4/7)
		{
			IR_Ctrl.ConHL[i]=1;
		}
		else
		{
			IR_Ctrl.ConHL[i]=0;
		}
	}
	for(int i=0; i<126 ; i++)
	{
		IR_Ctrl.Edge[i] = IR_Ctrl.ConHL[i]*(-1)
							+ IR_Ctrl.ConHL[i+1]*2
							+ IR_Ctrl.ConHL[i+2]*(-1);
	}
	for(int i=0; i<126 ; i++)
	{

		if(IR_Ctrl.Edge[i]==1)
		{
			IR_Ctrl.Count++;
		}

	}
} // Max 값은 유동적

void InfineonRacer_control(void){
	;
}
